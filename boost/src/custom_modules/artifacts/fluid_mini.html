<html><head><style>body,canvas,html,svg{width:100%;height:100%}body{background:#222;margin:0;font-family:Inter,sans-serif;position:fixed;overflow:hidden}canvas,svg{position:absolute;top:0;left:0}.status{color:#222;z-index:1000;backdrop-filter:blur(5px);background:#ffffff40;border-radius:.5rem;padding:.5rem;font-size:14px;position:absolute;top:1rem;left:1rem}</style></head><body><canvas></canvas><svg></svg><div class="status">...</div><script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script><script src="https://d3js.org/d3.v7.min.js"></script><script>class $e2fcf139534465c2$export$892596cec99bc70e{static fromHex(a){if(!/^#([0-9A-F]{3}){1,2}$/i.test(a))throw new Error("Invalid hex color format");const e=parseInt(a.slice(1),16);return new $e2fcf139534465c2$export$892596cec99bc70e((e>>16&255)/255,(e>>8&255)/255,(255&e)/255)}static fromRgb(a,e,r){return new $e2fcf139534465c2$export$892596cec99bc70e(a/255,e/255,r/255)}constructor(a,e,r){this.r=a,this.g=e,this.b=r}mute(a){return new $e2fcf139534465c2$export$892596cec99bc70e(this.r*a,this.g*a,this.b*a)}toGlColor(){return{r:this.r,g:this.g,b:this.b}}}const $4037aec382fdece7$export$e506a1d27d1eaa20={SIM_RESOLUTION:128,DYE_RESOLUTION:512,CAPTURE_RESOLUTION:512,DENSITY_DISSIPATION:2,VELOCITY_DISSIPATION:.6,PRESSURE:.5,PRESSURE_ITERATIONS:20,CURL:5,SPLAT_RADIUS:.001,SPLAT_FORCE:100,SHADING:!0,COLORFUL:!0,PAUSED:!1,BACK_COLOR:{r:20,g:20,b:20},TRANSPARENT:!1,BLOOM:!0,BLOOM_ITERATIONS:8,BLOOM_RESOLUTION:256,BLOOM_INTENSITY:.2,BLOOM_THRESHOLD:.6,BLOOM_SOFT_KNEE:.7,SUNRAYS:!0,SUNRAYS_RESOLUTION:196,SUNRAYS_WEIGHT:1,NODES_DRAGGABLE:!0,GRAPH_ZOOM:!1,GRAPH_TEXT_SIZE:16};function $889e0deb359ee8ae$export$e87bfa2a4c6bccb0(a,e){return null==a&&(a=1),null==e&&(e=a,a=0),a+Math.random()*(e-a)}function $889e0deb359ee8ae$export$d3bf3fb040d1ec84(a,e){return Math.floor($889e0deb359ee8ae$export$e87bfa2a4c6bccb0(a,e))}function $889e0deb359ee8ae$export$4154a199d7d90455(a){return a[Math.floor(Math.random()*a.length)]}function $889e0deb359ee8ae$export$7d15b64cf5a3a4c4(a,e,r){return Math.max(e,Math.min(r,a))}function $889e0deb359ee8ae$export$5c5ee632c52bc4a2(a){return $889e0deb359ee8ae$export$7d15b64cf5a3a4c4(a,0,1)}function $889e0deb359ee8ae$export$3a89f8d6f6bf6c9f(a,e,r){return a+(e-a)*r}function $889e0deb359ee8ae$export$2ad466be2e2b0196(a,e,r,c,$){return c+(a-e)*($-c)/(r-e)}function $889e0deb359ee8ae$export$d41d9ab3de2def3d(a){if(0==a.length)return 0;let e=0;for(let r=0;r<a.length;r++)e=(e<<5)-e+a.charCodeAt(r),e|=0;return e}function $889e0deb359ee8ae$export$4cde5df63f53f473(a){return{r:a.r/255,g:a.g/255,b:a.b/255}}function $889e0deb359ee8ae$export$4997ffc0176396a6(a,e,r){let c=r-e;return 0==c?e:(a-e)%c+e}function $889e0deb359ee8ae$export$e772c8ff12451969(a){return new Promise((e=>setTimeout(e,a)))}async function $889e0deb359ee8ae$export$49bb65c2ea163039(a){for(const e of a)await e()}function $17f951a440b1aeb0$export$253fcb83821ae15f(a,e,r,c){let $=a.createTexture();a.bindTexture(a.TEXTURE_2D,$),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,e,4,4,0,r,c,null);let t=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,t),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,$,0),a.checkFramebufferStatus(a.FRAMEBUFFER)==a.FRAMEBUFFER_COMPLETE}function $17f951a440b1aeb0$export$a8561130efc4e0c0(a,e,r,c){if(!$17f951a440b1aeb0$export$253fcb83821ae15f(a,e,r,c))switch(e){case a.R16F:return $17f951a440b1aeb0$export$a8561130efc4e0c0(a,a.RG16F,a.RG,c);case a.RG16F:return $17f951a440b1aeb0$export$a8561130efc4e0c0(a,a.RGBA16F,a.RGBA,c);default:return null}return{internalFormat:e,format:r}}function $17f951a440b1aeb0$export$c7a808a518b9a146(a){const e={alpha:!0,depth:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!1};let r=a.getContext("webgl2",e);const c=!!r;let $,t;c||(r=a.getContext("webgl",e)||a.getContext("experimental-webgl",e)),c?(r.getExtension("EXT_color_buffer_float"),t=r.getExtension("OES_texture_float_linear")):($=r.getExtension("OES_texture_half_float"),t=r.getExtension("OES_texture_half_float_linear")),r.clearColor(0,0,0,1);const d=c?r.HALF_FLOAT:$.HALF_FLOAT_OES;let f,i,n;return c?(f=$17f951a440b1aeb0$export$a8561130efc4e0c0(r,r.RGBA16F,r.RGBA,d),i=$17f951a440b1aeb0$export$a8561130efc4e0c0(r,r.RG16F,r.RG,d),n=$17f951a440b1aeb0$export$a8561130efc4e0c0(r,r.R16F,r.RED,d)):(f=$17f951a440b1aeb0$export$a8561130efc4e0c0(r,r.RGBA,r.RGBA,d),i=$17f951a440b1aeb0$export$a8561130efc4e0c0(r,r.RGBA,r.RGBA,d),n=$17f951a440b1aeb0$export$a8561130efc4e0c0(r,r.RGBA,r.RGBA,d)),{gl:r,ext:{formatRGBA:f,formatRG:i,formatR:n,halfFloatTexType:d,supportLinearFiltering:t}}}function $17f951a440b1aeb0$export$4e06fab977536f8e(a,e){let r=[],c=a.getProgramParameter(e,a.ACTIVE_UNIFORMS);for(let $=0;$<c;$++){let c=a.getActiveUniform(e,$).name;r[c]=a.getUniformLocation(e,c)}return r}function $17f951a440b1aeb0$export$327d24a04cd0dc17(a,e,r){let c=a.createProgram();return a.attachShader(c,e),a.attachShader(c,r),a.linkProgram(c),a.getProgramParameter(c,a.LINK_STATUS)||console.trace(a.getProgramInfoLog(c)),c}class $17f951a440b1aeb0$export$b6c59b989905b650{constructor(a,e,r){this.gl=a,this.uniforms={},this.program=$17f951a440b1aeb0$export$327d24a04cd0dc17(this.gl,e,r),this.uniforms=$17f951a440b1aeb0$export$4e06fab977536f8e(this.gl,this.program)}bind(){this.gl.useProgram(this.program)}}class $17f951a440b1aeb0$export$a2d8b23205c25948{constructor(a,e,r){this.gl=a,this.vertexShader=e,this.fragmentShaderSource=r,this.programs=[],this.activeProgram=null,this.uniforms=[]}setKeywords(a){let e=0;for(let r=0;r<a.length;r++)e+=$889e0deb359ee8ae$export$d41d9ab3de2def3d(a[r]);let r=this.programs[e];if(null==r){let c=$17f951a440b1aeb0$export$9b5304f4eb007cf0(this.gl,this.gl.FRAGMENT_SHADER,this.fragmentShaderSource,a);r=$17f951a440b1aeb0$export$327d24a04cd0dc17(this.gl,this.vertexShader,c),this.programs[e]=r}r!=this.activeProgram&&(this.uniforms=$17f951a440b1aeb0$export$4e06fab977536f8e(this.gl,r),this.activeProgram=r)}bind(){this.gl.useProgram(this.activeProgram)}}function $17f951a440b1aeb0$export$9b5304f4eb007cf0(a,e,r,c){r=$17f951a440b1aeb0$var$addKeywords(r,c);const $=a.createShader(e);return a.shaderSource($,r),a.compileShader($),a.getShaderParameter($,a.COMPILE_STATUS)||console.trace(a.getShaderInfoLog($)),$}function $17f951a440b1aeb0$var$addKeywords(a,e){if(null==e)return a;let r="";return e.forEach((a=>{r+="#define "+a+"\n"})),r+a}class $1c68cc7ba7d4081d$export$b56007f12edf0c17{constructor(){this.id=-1,this.texcoordX=0,this.texcoordY=0,this.prevTexcoordX=0,this.prevTexcoordY=0,this.deltaX=0,this.deltaY=0,this.down=!1,this.moved=!1,this.radius=.005,this.color={r:.005,g:.005,b:.005}}}const $7cd9a1131fd2cf81$var$canvas=document.getElementsByTagName("canvas")[0];$7cd9a1131fd2cf81$var$resizeCanvas();class $7cd9a1131fd2cf81$export$d5f25c77fde4b279{constructor(){this.lastUpdateTime=Date.now(),this.noiseSpeed=5,this.pointers=[],this.splatStack=[],this.pointers.push(new $1c68cc7ba7d4081d$export$b56007f12edf0c17)}init(){$7cd9a1131fd2cf81$var$updateKeywords(),$7cd9a1131fd2cf81$var$initFramebuffers(),this.update(),this.initialSplat()}calcDeltaTime(){let a=Date.now(),e=(a-this.lastUpdateTime)/1e3;return e=Math.min(e,.016666),this.lastUpdateTime=a,e}update(){const a=this.calcDeltaTime();$7cd9a1131fd2cf81$var$resizeCanvas()&&$7cd9a1131fd2cf81$var$initFramebuffers(),this.applyInputs(),$4037aec382fdece7$export$e506a1d27d1eaa20.PAUSED||$7cd9a1131fd2cf81$var$step(a),this.render(null),this.backgroundNoise(),requestAnimationFrame(this.update.bind(this))}applyInputs(){this.pointers.forEach((a=>{a.moved&&(a.moved=!1,this.splatPointer(a))}))}splatPointer(a){let e=a.deltaX*$4037aec382fdece7$export$e506a1d27d1eaa20.SPLAT_FORCE,r=a.deltaY*$4037aec382fdece7$export$e506a1d27d1eaa20.SPLAT_FORCE;this.splat({x:a.texcoordX,y:a.texcoordY,dx:e,dy:r,radius:a.radius,color:a.color})}multipleSplats(a){for(let e=0;e<a;e++){const a=$7cd9a1131fd2cf81$var$generateColor();a.r*=10,a.g*=10,a.b*=10;const e=Math.random(),r=Math.random(),c=200*(Math.random()-.5),$=200*(Math.random()+1);this.splat({x:e,y:r,dx:c,dy:$,color:a})}}clusterSplat(a={}){const e=a?.wiggle??.05,r=a?.position?.x??$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(e,1-e),c=a?.position?.y??$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(e,1-e),$=a?.amount??$889e0deb359ee8ae$export$d3bf3fb040d1ec84(3,8);for(let a=0;a<$;a++){const a={r:.12,g:.12,b:.35},$=r+$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-e,e),t=c+$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-e,e),d=200*$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-1,1),f=200*$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-1,1);fluidSim.splat({x:$,y:t,dx:d,dy:f,color:a})}}render(a){$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM&&$7cd9a1131fd2cf81$var$applyBloom($7cd9a1131fd2cf81$var$dye.read,$7cd9a1131fd2cf81$var$bloom),$4037aec382fdece7$export$e506a1d27d1eaa20.SUNRAYS&&($7cd9a1131fd2cf81$var$applySunrays($7cd9a1131fd2cf81$var$dye.read,$7cd9a1131fd2cf81$var$dye.write,$7cd9a1131fd2cf81$var$sunrays),$7cd9a1131fd2cf81$var$blur($7cd9a1131fd2cf81$var$sunrays,$7cd9a1131fd2cf81$var$sunraysTemp,1)),null!=a&&$4037aec382fdece7$export$e506a1d27d1eaa20.TRANSPARENT?$7cd9a1131fd2cf81$var$gl.disable($7cd9a1131fd2cf81$var$gl.BLEND):($7cd9a1131fd2cf81$var$gl.blendFunc($7cd9a1131fd2cf81$var$gl.ONE,$7cd9a1131fd2cf81$var$gl.ONE_MINUS_SRC_ALPHA),$7cd9a1131fd2cf81$var$gl.enable($7cd9a1131fd2cf81$var$gl.BLEND)),$4037aec382fdece7$export$e506a1d27d1eaa20.TRANSPARENT||$7cd9a1131fd2cf81$var$drawColor(a,$889e0deb359ee8ae$export$4cde5df63f53f473($4037aec382fdece7$export$e506a1d27d1eaa20.BACK_COLOR)),null==a&&$4037aec382fdece7$export$e506a1d27d1eaa20.TRANSPARENT&&$7cd9a1131fd2cf81$var$drawCheckerboard(a),$7cd9a1131fd2cf81$var$drawDisplay(a)}splat({x:a,y:e,dx:r,dy:c,color:$,radius:t=$4037aec382fdece7$export$e506a1d27d1eaa20.SPLAT_RADIUS}){$7cd9a1131fd2cf81$var$splatProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$splatProgram.uniforms.uTarget,$7cd9a1131fd2cf81$var$velocity.read.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$splatProgram.uniforms.aspectRatio,$7cd9a1131fd2cf81$var$canvas.width/$7cd9a1131fd2cf81$var$canvas.height),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$splatProgram.uniforms.point,a,e),$7cd9a1131fd2cf81$var$gl.uniform3f($7cd9a1131fd2cf81$var$splatProgram.uniforms.color,r,c,0),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$splatProgram.uniforms.radius,$7cd9a1131fd2cf81$var$correctRadius(t)),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$velocity.write),$7cd9a1131fd2cf81$var$velocity.swap(),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$splatProgram.uniforms.uTarget,$7cd9a1131fd2cf81$var$dye.read.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform3f($7cd9a1131fd2cf81$var$splatProgram.uniforms.color,$.r,$.g,$.b),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$dye.write),$7cd9a1131fd2cf81$var$dye.swap()}backgroundNoise(){const a=this.noiseSpeed;Array(1).fill(0).forEach((()=>{const e={x:$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(.3,.7),y:$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(1)},r=$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(.001,.05),c=$889e0deb359ee8ae$export$2ad466be2e2b0196(r,.001,.05,.01,.001);this.splat({x:e.x,y:e.y,dx:$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-a,a),dy:$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-a,a),color:{r:c,g:c,b:c},radius:r})}))}initialSplat(){this.splat({x:.5,y:.6,dx:0,dy:-10,color:{r:.01,g:.01,b:.01},radius:.6})}}const{gl:$7cd9a1131fd2cf81$var$gl,ext:$7cd9a1131fd2cf81$var$ext}=$17f951a440b1aeb0$export$c7a808a518b9a146($7cd9a1131fd2cf81$var$canvas);$7cd9a1131fd2cf81$var$ext.supportLinearFiltering||($4037aec382fdece7$export$e506a1d27d1eaa20.DYE_RESOLUTION=512,$4037aec382fdece7$export$e506a1d27d1eaa20.SHADING=!1,$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM=!1,$4037aec382fdece7$export$e506a1d27d1eaa20.SUNRAYS=!1);const $7cd9a1131fd2cf81$var$baseVertexShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.VERTEX_SHADER,"\n    precision highp float;\n\n    attribute vec2 aPosition;\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform vec2 texelSize;\n\n    void main () {\n        vUv = aPosition * 0.5 + 0.5;\n        vL = vUv - vec2(texelSize.x, 0.0);\n        vR = vUv + vec2(texelSize.x, 0.0);\n        vT = vUv + vec2(0.0, texelSize.y);\n        vB = vUv - vec2(0.0, texelSize.y);\n        gl_Position = vec4(aPosition, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$blurVertexShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.VERTEX_SHADER,"\n    precision highp float;\n\n    attribute vec2 aPosition;\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    uniform vec2 texelSize;\n\n    void main () {\n        vUv = aPosition * 0.5 + 0.5;\n        float offset = 1.33333333;\n        vL = vUv - texelSize * offset;\n        vR = vUv + texelSize * offset;\n        gl_Position = vec4(aPosition, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$blurShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    uniform sampler2D uTexture;\n\n    void main () {\n        vec4 sum = texture2D(uTexture, vUv) * 0.29411764;\n        sum += texture2D(uTexture, vL) * 0.35294117;\n        sum += texture2D(uTexture, vR) * 0.35294117;\n        gl_FragColor = sum;\n    }\n"),$7cd9a1131fd2cf81$var$copyShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    uniform sampler2D uTexture;\n\n    void main () {\n        gl_FragColor = texture2D(uTexture, vUv);\n    }\n"),$7cd9a1131fd2cf81$var$clearShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float value;\n\n    void main () {\n        gl_FragColor = value * texture2D(uTexture, vUv);\n    }\n"),$7cd9a1131fd2cf81$var$colorShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n\n    uniform vec4 color;\n\n    void main () {\n        gl_FragColor = color;\n    }\n"),$7cd9a1131fd2cf81$var$checkerboardShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float aspectRatio;\n\n    #define SCALE 25.0\n\n    void main () {\n        vec2 uv = floor(vUv * SCALE * vec2(aspectRatio, 1.0));\n        float v = mod(uv.x + uv.y, 2.0);\n        v = v * 0.1 + 0.8;\n        gl_FragColor = vec4(vec3(v), 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$displayShaderSource="\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uTexture;\n    uniform sampler2D uBloom;\n    uniform sampler2D uSunrays;\n    uniform sampler2D uDithering;\n    uniform vec2 ditherScale;\n    uniform vec2 texelSize;\n\n    vec3 linearToGamma (vec3 color) {\n        color = max(color, vec3(0));\n        return max(1.055 * pow(color, vec3(0.416666667)) - 0.055, vec3(0));\n    }\n\n    void main () {\n        vec3 c = texture2D(uTexture, vUv).rgb;\n\n    #ifdef SHADING\n        vec3 lc = texture2D(uTexture, vL).rgb;\n        vec3 rc = texture2D(uTexture, vR).rgb;\n        vec3 tc = texture2D(uTexture, vT).rgb;\n        vec3 bc = texture2D(uTexture, vB).rgb;\n\n        float dx = length(rc) - length(lc);\n        float dy = length(tc) - length(bc);\n\n        vec3 n = normalize(vec3(dx, dy, length(texelSize)));\n        vec3 l = vec3(0.0, 0.0, 1.0);\n\n        float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);\n        c *= diffuse;\n    #endif\n\n    #ifdef BLOOM\n        vec3 bloom = texture2D(uBloom, vUv).rgb;\n    #endif\n\n    #ifdef SUNRAYS\n        float sunrays = texture2D(uSunrays, vUv).r;\n        c *= sunrays;\n    #ifdef BLOOM\n        bloom *= sunrays;\n    #endif\n    #endif\n\n    #ifdef BLOOM\n        float noise = texture2D(uDithering, vUv * ditherScale).r;\n        noise = noise * 2.0 - 1.0;\n        bloom += noise / 255.0;\n        bloom = linearToGamma(bloom);\n        c += bloom;\n    #endif\n\n        float a = max(c.r, max(c.g, c.b));\n        gl_FragColor = vec4(c, a);\n    }\n",$7cd9a1131fd2cf81$var$bloomPrefilterShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform vec3 curve;\n    uniform float threshold;\n\n    void main () {\n        vec3 c = texture2D(uTexture, vUv).rgb;\n        float br = max(c.r, max(c.g, c.b));\n        float rq = clamp(br - curve.x, 0.0, curve.y);\n        rq = curve.z * rq * rq;\n        c *= max(rq, br - threshold) / max(br, 0.0001);\n        gl_FragColor = vec4(c, 0.0);\n    }\n"),$7cd9a1131fd2cf81$var$bloomBlurShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uTexture;\n\n    void main () {\n        vec4 sum = vec4(0.0);\n        sum += texture2D(uTexture, vL);\n        sum += texture2D(uTexture, vR);\n        sum += texture2D(uTexture, vT);\n        sum += texture2D(uTexture, vB);\n        sum *= 0.25;\n        gl_FragColor = sum;\n    }\n"),$7cd9a1131fd2cf81$var$bloomFinalShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uTexture;\n    uniform float intensity;\n\n    void main () {\n        vec4 sum = vec4(0.0);\n        sum += texture2D(uTexture, vL);\n        sum += texture2D(uTexture, vR);\n        sum += texture2D(uTexture, vT);\n        sum += texture2D(uTexture, vB);\n        sum *= 0.25;\n        gl_FragColor = sum * intensity;\n    }\n"),$7cd9a1131fd2cf81$var$sunraysMaskShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n\n    void main () {\n        vec4 c = texture2D(uTexture, vUv);\n        float br = max(c.r, max(c.g, c.b));\n        c.a = 1.0 - min(max(br * 20.0, 0.0), 0.8);\n        gl_FragColor = c;\n    }\n"),$7cd9a1131fd2cf81$var$sunraysShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float weight;\n\n    #define ITERATIONS 16\n\n    void main () {\n        float Density = 0.3;\n        float Decay = 0.95;\n        float Exposure = 0.7;\n\n        vec2 coord = vUv;\n        vec2 dir = vUv - 0.5;\n\n        dir *= 1.0 / float(ITERATIONS) * Density;\n        float illuminationDecay = 1.0;\n\n        float color = texture2D(uTexture, vUv).a;\n\n        for (int i = 0; i < ITERATIONS; i++)\n        {\n            coord -= dir;\n            float col = texture2D(uTexture, coord).a;\n            color += col * illuminationDecay * weight;\n            illuminationDecay *= Decay;\n        }\n\n        gl_FragColor = vec4(color * Exposure, 0.0, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$splatShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTarget;\n    uniform float aspectRatio;\n    uniform vec3 color;\n    uniform vec2 point;\n    uniform float radius;\n\n    void main () {\n        vec2 p = vUv - point.xy;\n        p.x *= aspectRatio;\n        float dist = dot(p, p);\n        float r = radius;\n        // Use smoothstep for a soft edge instead of abrupt cutoff\n        float falloff = smoothstep(r, 0.0, dist);\n        vec3 splat = falloff * color;\n        vec3 base = texture2D(uTarget, vUv).xyz;\n        gl_FragColor = vec4(base + splat, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$advectionShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uSource;\n    uniform vec2 texelSize;\n    uniform vec2 dyeTexelSize;\n    uniform float dt;\n    uniform float dissipation;\n\n    vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {\n        vec2 st = uv / tsize - 0.5;\n\n        vec2 iuv = floor(st);\n        vec2 fuv = fract(st);\n\n        vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);\n        vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);\n        vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);\n        vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);\n\n        return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);\n    }\n\n    void main () {\n    #ifdef MANUAL_FILTERING\n        vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize;\n        vec4 result = bilerp(uSource, coord, dyeTexelSize);\n    #else\n        vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n        vec4 result = texture2D(uSource, coord);\n    #endif\n        float decay = 1.0 + dissipation * dt;\n        gl_FragColor = result / decay;\n    }",$7cd9a1131fd2cf81$var$ext.supportLinearFiltering?null:["MANUAL_FILTERING"]),$7cd9a1131fd2cf81$var$divergenceShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uVelocity;\n\n    void main () {\n        float L = texture2D(uVelocity, vL).x;\n        float R = texture2D(uVelocity, vR).x;\n        float T = texture2D(uVelocity, vT).y;\n        float B = texture2D(uVelocity, vB).y;\n\n        vec2 C = texture2D(uVelocity, vUv).xy;\n        if (vL.x < 0.0) { L = -C.x; }\n        if (vR.x > 1.0) { R = -C.x; }\n        if (vT.y > 1.0) { T = -C.y; }\n        if (vB.y < 0.0) { B = -C.y; }\n\n        float div = 0.5 * (R - L + T - B);\n        gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$curlShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uVelocity;\n\n    void main () {\n        float L = texture2D(uVelocity, vL).y;\n        float R = texture2D(uVelocity, vR).y;\n        float T = texture2D(uVelocity, vT).x;\n        float B = texture2D(uVelocity, vB).x;\n        float vorticity = R - L - T + B;\n        gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$vorticityShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uCurl;\n    uniform float curl;\n    uniform float dt;\n\n    void main () {\n        float L = texture2D(uCurl, vL).x;\n        float R = texture2D(uCurl, vR).x;\n        float T = texture2D(uCurl, vT).x;\n        float B = texture2D(uCurl, vB).x;\n        float C = texture2D(uCurl, vUv).x;\n\n        vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n        force /= length(force) + 0.0001;\n        force *= curl * C;\n        force.y *= -1.0;\n\n        vec2 velocity = texture2D(uVelocity, vUv).xy;\n        velocity += force * dt;\n        velocity = min(max(velocity, -1000.0), 1000.0);\n        gl_FragColor = vec4(velocity, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$pressureShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uPressure;\n    uniform sampler2D uDivergence;\n\n    void main () {\n        float L = texture2D(uPressure, vL).x;\n        float R = texture2D(uPressure, vR).x;\n        float T = texture2D(uPressure, vT).x;\n        float B = texture2D(uPressure, vB).x;\n        float C = texture2D(uPressure, vUv).x;\n        float divergence = texture2D(uDivergence, vUv).x;\n        float pressure = (L + R + B + T - divergence) * 0.25;\n        gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$gradientSubtractShader=$17f951a440b1aeb0$export$9b5304f4eb007cf0($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$gl.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uPressure;\n    uniform sampler2D uVelocity;\n\n    void main () {\n        float L = texture2D(uPressure, vL).x;\n        float R = texture2D(uPressure, vR).x;\n        float T = texture2D(uPressure, vT).x;\n        float B = texture2D(uPressure, vB).x;\n        vec2 velocity = texture2D(uVelocity, vUv).xy;\n        velocity.xy -= vec2(R - L, T - B);\n        gl_FragColor = vec4(velocity, 0.0, 1.0);\n    }\n"),$7cd9a1131fd2cf81$var$blit=($7cd9a1131fd2cf81$var$gl.bindBuffer($7cd9a1131fd2cf81$var$gl.ARRAY_BUFFER,$7cd9a1131fd2cf81$var$gl.createBuffer()),$7cd9a1131fd2cf81$var$gl.bufferData($7cd9a1131fd2cf81$var$gl.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),$7cd9a1131fd2cf81$var$gl.STATIC_DRAW),$7cd9a1131fd2cf81$var$gl.bindBuffer($7cd9a1131fd2cf81$var$gl.ELEMENT_ARRAY_BUFFER,$7cd9a1131fd2cf81$var$gl.createBuffer()),$7cd9a1131fd2cf81$var$gl.bufferData($7cd9a1131fd2cf81$var$gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),$7cd9a1131fd2cf81$var$gl.STATIC_DRAW),$7cd9a1131fd2cf81$var$gl.vertexAttribPointer(0,2,$7cd9a1131fd2cf81$var$gl.FLOAT,!1,0,0),$7cd9a1131fd2cf81$var$gl.enableVertexAttribArray(0),(a,e=!1)=>{null==a?($7cd9a1131fd2cf81$var$gl.viewport(0,0,$7cd9a1131fd2cf81$var$gl.drawingBufferWidth,$7cd9a1131fd2cf81$var$gl.drawingBufferHeight),$7cd9a1131fd2cf81$var$gl.bindFramebuffer($7cd9a1131fd2cf81$var$gl.FRAMEBUFFER,null)):($7cd9a1131fd2cf81$var$gl.viewport(0,0,a.width,a.height),$7cd9a1131fd2cf81$var$gl.bindFramebuffer($7cd9a1131fd2cf81$var$gl.FRAMEBUFFER,a.fbo)),e&&($7cd9a1131fd2cf81$var$gl.clearColor(0,0,0,1),$7cd9a1131fd2cf81$var$gl.clear($7cd9a1131fd2cf81$var$gl.COLOR_BUFFER_BIT)),$7cd9a1131fd2cf81$var$gl.drawElements($7cd9a1131fd2cf81$var$gl.TRIANGLES,6,$7cd9a1131fd2cf81$var$gl.UNSIGNED_SHORT,0)});function $7cd9a1131fd2cf81$var$CHECK_FRAMEBUFFER_STATUS(){let a=$7cd9a1131fd2cf81$var$gl.checkFramebufferStatus($7cd9a1131fd2cf81$var$gl.FRAMEBUFFER);a!=$7cd9a1131fd2cf81$var$gl.FRAMEBUFFER_COMPLETE&&console.trace("Framebuffer error: "+a)}let $7cd9a1131fd2cf81$var$dye,$7cd9a1131fd2cf81$var$velocity,$7cd9a1131fd2cf81$var$divergence,$7cd9a1131fd2cf81$var$curl,$7cd9a1131fd2cf81$var$pressure,$7cd9a1131fd2cf81$var$bloom,$7cd9a1131fd2cf81$var$sunrays,$7cd9a1131fd2cf81$var$sunraysTemp,$7cd9a1131fd2cf81$var$bloomFramebuffers=[],$7cd9a1131fd2cf81$var$ditheringTexture=$7cd9a1131fd2cf81$var$createTextureAsync("LDR_LLL1_0.png");const $7cd9a1131fd2cf81$var$blurProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$blurVertexShader,$7cd9a1131fd2cf81$var$blurShader),$7cd9a1131fd2cf81$var$copyProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$copyShader),$7cd9a1131fd2cf81$var$clearProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$clearShader),$7cd9a1131fd2cf81$var$colorProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$colorShader),$7cd9a1131fd2cf81$var$checkerboardProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$checkerboardShader),$7cd9a1131fd2cf81$var$bloomPrefilterProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$bloomPrefilterShader),$7cd9a1131fd2cf81$var$bloomBlurProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$bloomBlurShader),$7cd9a1131fd2cf81$var$bloomFinalProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$bloomFinalShader),$7cd9a1131fd2cf81$var$sunraysMaskProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$sunraysMaskShader),$7cd9a1131fd2cf81$var$sunraysProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$sunraysShader),$7cd9a1131fd2cf81$var$splatProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$splatShader),$7cd9a1131fd2cf81$var$advectionProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$advectionShader),$7cd9a1131fd2cf81$var$divergenceProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$divergenceShader),$7cd9a1131fd2cf81$var$curlProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$curlShader),$7cd9a1131fd2cf81$var$vorticityProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$vorticityShader),$7cd9a1131fd2cf81$var$pressureProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$pressureShader),$7cd9a1131fd2cf81$var$gradienSubtractProgram=new $17f951a440b1aeb0$export$b6c59b989905b650($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$gradientSubtractShader),$7cd9a1131fd2cf81$var$displayMaterial=new $17f951a440b1aeb0$export$a2d8b23205c25948($7cd9a1131fd2cf81$var$gl,$7cd9a1131fd2cf81$var$baseVertexShader,$7cd9a1131fd2cf81$var$displayShaderSource);function $7cd9a1131fd2cf81$var$initFramebuffers(){let a=$7cd9a1131fd2cf81$var$getResolution($4037aec382fdece7$export$e506a1d27d1eaa20.SIM_RESOLUTION),e=$7cd9a1131fd2cf81$var$getResolution($4037aec382fdece7$export$e506a1d27d1eaa20.DYE_RESOLUTION);const r=$7cd9a1131fd2cf81$var$ext.halfFloatTexType,c=$7cd9a1131fd2cf81$var$ext.formatRGBA,$=$7cd9a1131fd2cf81$var$ext.formatRG,t=$7cd9a1131fd2cf81$var$ext.formatR,d=$7cd9a1131fd2cf81$var$ext.supportLinearFiltering?$7cd9a1131fd2cf81$var$gl.LINEAR:$7cd9a1131fd2cf81$var$gl.NEAREST;$7cd9a1131fd2cf81$var$gl.disable($7cd9a1131fd2cf81$var$gl.BLEND),$7cd9a1131fd2cf81$var$dye=null==$7cd9a1131fd2cf81$var$dye?$7cd9a1131fd2cf81$var$createDoubleFBO(e.width,e.height,c.internalFormat,c.format,r,d):$7cd9a1131fd2cf81$var$resizeDoubleFBO($7cd9a1131fd2cf81$var$dye,e.width,e.height,c.internalFormat,c.format,r,d),$7cd9a1131fd2cf81$var$velocity=null==$7cd9a1131fd2cf81$var$velocity?$7cd9a1131fd2cf81$var$createDoubleFBO(a.width,a.height,$.internalFormat,$.format,r,d):$7cd9a1131fd2cf81$var$resizeDoubleFBO($7cd9a1131fd2cf81$var$velocity,a.width,a.height,$.internalFormat,$.format,r,d),$7cd9a1131fd2cf81$var$divergence=$7cd9a1131fd2cf81$var$createFBO(a.width,a.height,t.internalFormat,t.format,r,$7cd9a1131fd2cf81$var$gl.NEAREST),$7cd9a1131fd2cf81$var$curl=$7cd9a1131fd2cf81$var$createFBO(a.width,a.height,t.internalFormat,t.format,r,$7cd9a1131fd2cf81$var$gl.NEAREST),$7cd9a1131fd2cf81$var$pressure=$7cd9a1131fd2cf81$var$createDoubleFBO(a.width,a.height,t.internalFormat,t.format,r,$7cd9a1131fd2cf81$var$gl.NEAREST),$7cd9a1131fd2cf81$var$initBloomFramebuffers(),$7cd9a1131fd2cf81$var$initSunraysFramebuffers()}function $7cd9a1131fd2cf81$var$initBloomFramebuffers(){let a=$7cd9a1131fd2cf81$var$getResolution($4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_RESOLUTION);const e=$7cd9a1131fd2cf81$var$ext.halfFloatTexType,r=$7cd9a1131fd2cf81$var$ext.formatRGBA,c=$7cd9a1131fd2cf81$var$ext.supportLinearFiltering?$7cd9a1131fd2cf81$var$gl.LINEAR:$7cd9a1131fd2cf81$var$gl.NEAREST;$7cd9a1131fd2cf81$var$bloom=$7cd9a1131fd2cf81$var$createFBO(a.width,a.height,r.internalFormat,r.format,e,c),$7cd9a1131fd2cf81$var$bloomFramebuffers.length=0;for(let $=0;$<$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_ITERATIONS;$++){let t=a.width>>$+1,d=a.height>>$+1;if(t<2||d<2)break;let f=$7cd9a1131fd2cf81$var$createFBO(t,d,r.internalFormat,r.format,e,c);$7cd9a1131fd2cf81$var$bloomFramebuffers.push(f)}}function $7cd9a1131fd2cf81$var$initSunraysFramebuffers(){let a=$7cd9a1131fd2cf81$var$getResolution($4037aec382fdece7$export$e506a1d27d1eaa20.SUNRAYS_RESOLUTION);const e=$7cd9a1131fd2cf81$var$ext.halfFloatTexType,r=$7cd9a1131fd2cf81$var$ext.formatR,c=$7cd9a1131fd2cf81$var$ext.supportLinearFiltering?$7cd9a1131fd2cf81$var$gl.LINEAR:$7cd9a1131fd2cf81$var$gl.NEAREST;$7cd9a1131fd2cf81$var$sunrays=$7cd9a1131fd2cf81$var$createFBO(a.width,a.height,r.internalFormat,r.format,e,c),$7cd9a1131fd2cf81$var$sunraysTemp=$7cd9a1131fd2cf81$var$createFBO(a.width,a.height,r.internalFormat,r.format,e,c)}function $7cd9a1131fd2cf81$var$createFBO(a,e,r,c,$,t){$7cd9a1131fd2cf81$var$gl.activeTexture($7cd9a1131fd2cf81$var$gl.TEXTURE0);let d=$7cd9a1131fd2cf81$var$gl.createTexture();$7cd9a1131fd2cf81$var$gl.bindTexture($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,d),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_MIN_FILTER,t),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_MAG_FILTER,t),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_WRAP_S,$7cd9a1131fd2cf81$var$gl.CLAMP_TO_EDGE),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_WRAP_T,$7cd9a1131fd2cf81$var$gl.CLAMP_TO_EDGE),$7cd9a1131fd2cf81$var$gl.texImage2D($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,0,r,a,e,0,c,$,null);let f=$7cd9a1131fd2cf81$var$gl.createFramebuffer();return $7cd9a1131fd2cf81$var$gl.bindFramebuffer($7cd9a1131fd2cf81$var$gl.FRAMEBUFFER,f),$7cd9a1131fd2cf81$var$gl.framebufferTexture2D($7cd9a1131fd2cf81$var$gl.FRAMEBUFFER,$7cd9a1131fd2cf81$var$gl.COLOR_ATTACHMENT0,$7cd9a1131fd2cf81$var$gl.TEXTURE_2D,d,0),$7cd9a1131fd2cf81$var$gl.viewport(0,0,a,e),$7cd9a1131fd2cf81$var$gl.clear($7cd9a1131fd2cf81$var$gl.COLOR_BUFFER_BIT),{texture:d,fbo:f,width:a,height:e,texelSizeX:1/a,texelSizeY:1/e,attach:a=>($7cd9a1131fd2cf81$var$gl.activeTexture($7cd9a1131fd2cf81$var$gl.TEXTURE0+a),$7cd9a1131fd2cf81$var$gl.bindTexture($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,d),a)}}function $7cd9a1131fd2cf81$var$createDoubleFBO(a,e,r,c,$,t){let d=$7cd9a1131fd2cf81$var$createFBO(a,e,r,c,$,t),f=$7cd9a1131fd2cf81$var$createFBO(a,e,r,c,$,t);return{width:a,height:e,texelSizeX:d.texelSizeX,texelSizeY:d.texelSizeY,get read(){return d},set read(a){d=a},get write(){return f},set write(a){f=a},swap(){let a=d;d=f,f=a}}}function $7cd9a1131fd2cf81$var$resizeFBO(a,e,r,c,$,t,d){let f=$7cd9a1131fd2cf81$var$createFBO(e,r,c,$,t,d);return $7cd9a1131fd2cf81$var$copyProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$copyProgram.uniforms.uTexture,a.attach(0)),$7cd9a1131fd2cf81$var$blit(f),f}function $7cd9a1131fd2cf81$var$resizeDoubleFBO(a,e,r,c,$,t,d){return a.width==e&&a.height==r||(a.read=$7cd9a1131fd2cf81$var$resizeFBO(a.read,e,r,c,$,t,d),a.write=$7cd9a1131fd2cf81$var$createFBO(e,r,c,$,t,d),a.width=e,a.height=r,a.texelSizeX=1/e,a.texelSizeY=1/r),a}function $7cd9a1131fd2cf81$var$createTextureAsync(a){let e=$7cd9a1131fd2cf81$var$gl.createTexture();$7cd9a1131fd2cf81$var$gl.bindTexture($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,e),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_MIN_FILTER,$7cd9a1131fd2cf81$var$gl.LINEAR),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_MAG_FILTER,$7cd9a1131fd2cf81$var$gl.LINEAR),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_WRAP_S,$7cd9a1131fd2cf81$var$gl.REPEAT),$7cd9a1131fd2cf81$var$gl.texParameteri($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,$7cd9a1131fd2cf81$var$gl.TEXTURE_WRAP_T,$7cd9a1131fd2cf81$var$gl.REPEAT),$7cd9a1131fd2cf81$var$gl.texImage2D($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,0,$7cd9a1131fd2cf81$var$gl.RGB,1,1,0,$7cd9a1131fd2cf81$var$gl.RGB,$7cd9a1131fd2cf81$var$gl.UNSIGNED_BYTE,new Uint8Array([255,255,255]));let r={texture:e,width:1,height:1,attach:a=>($7cd9a1131fd2cf81$var$gl.activeTexture($7cd9a1131fd2cf81$var$gl.TEXTURE0+a),$7cd9a1131fd2cf81$var$gl.bindTexture($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,e),a)},c=new Image;return c.onload=()=>{r.width=c.width,r.height=c.height,$7cd9a1131fd2cf81$var$gl.bindTexture($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,e),$7cd9a1131fd2cf81$var$gl.texImage2D($7cd9a1131fd2cf81$var$gl.TEXTURE_2D,0,$7cd9a1131fd2cf81$var$gl.RGB,$7cd9a1131fd2cf81$var$gl.RGB,$7cd9a1131fd2cf81$var$gl.UNSIGNED_BYTE,c)},c.src=a,r}function $7cd9a1131fd2cf81$var$updateKeywords(){let a=[];$4037aec382fdece7$export$e506a1d27d1eaa20.SHADING&&a.push("SHADING"),$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM&&a.push("BLOOM"),$4037aec382fdece7$export$e506a1d27d1eaa20.SUNRAYS&&a.push("SUNRAYS"),$7cd9a1131fd2cf81$var$displayMaterial.setKeywords(a)}let $7cd9a1131fd2cf81$var$lastUpdateTime=Date.now(),$7cd9a1131fd2cf81$var$colorUpdateTimer=0;function $7cd9a1131fd2cf81$var$resizeCanvas(){let a=$7cd9a1131fd2cf81$var$scaleByPixelRatio($7cd9a1131fd2cf81$var$canvas.clientWidth),e=$7cd9a1131fd2cf81$var$scaleByPixelRatio($7cd9a1131fd2cf81$var$canvas.clientHeight);return($7cd9a1131fd2cf81$var$canvas.width!=a||$7cd9a1131fd2cf81$var$canvas.height!=e)&&($7cd9a1131fd2cf81$var$canvas.width=a,$7cd9a1131fd2cf81$var$canvas.height=e,!0)}function $7cd9a1131fd2cf81$var$step(a){$7cd9a1131fd2cf81$var$gl.disable($7cd9a1131fd2cf81$var$gl.BLEND),$7cd9a1131fd2cf81$var$curlProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$curlProgram.uniforms.texelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$curlProgram.uniforms.uVelocity,$7cd9a1131fd2cf81$var$velocity.read.attach(0)),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$curl),$7cd9a1131fd2cf81$var$vorticityProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$vorticityProgram.uniforms.texelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$vorticityProgram.uniforms.uVelocity,$7cd9a1131fd2cf81$var$velocity.read.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$vorticityProgram.uniforms.uCurl,$7cd9a1131fd2cf81$var$curl.attach(1)),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$vorticityProgram.uniforms.curl,$4037aec382fdece7$export$e506a1d27d1eaa20.CURL),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$vorticityProgram.uniforms.dt,a),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$velocity.write),$7cd9a1131fd2cf81$var$velocity.swap(),$7cd9a1131fd2cf81$var$divergenceProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$divergenceProgram.uniforms.texelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$divergenceProgram.uniforms.uVelocity,$7cd9a1131fd2cf81$var$velocity.read.attach(0)),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$divergence),$7cd9a1131fd2cf81$var$clearProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$clearProgram.uniforms.uTexture,$7cd9a1131fd2cf81$var$pressure.read.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$clearProgram.uniforms.value,$4037aec382fdece7$export$e506a1d27d1eaa20.PRESSURE),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$pressure.write),$7cd9a1131fd2cf81$var$pressure.swap(),$7cd9a1131fd2cf81$var$pressureProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$pressureProgram.uniforms.texelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$pressureProgram.uniforms.uDivergence,$7cd9a1131fd2cf81$var$divergence.attach(0));for(let a=0;a<$4037aec382fdece7$export$e506a1d27d1eaa20.PRESSURE_ITERATIONS;a++)$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$pressureProgram.uniforms.uPressure,$7cd9a1131fd2cf81$var$pressure.read.attach(1)),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$pressure.write),$7cd9a1131fd2cf81$var$pressure.swap();$7cd9a1131fd2cf81$var$gradienSubtractProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$gradienSubtractProgram.uniforms.texelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$gradienSubtractProgram.uniforms.uPressure,$7cd9a1131fd2cf81$var$pressure.read.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$gradienSubtractProgram.uniforms.uVelocity,$7cd9a1131fd2cf81$var$velocity.read.attach(1)),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$velocity.write),$7cd9a1131fd2cf81$var$velocity.swap(),$7cd9a1131fd2cf81$var$advectionProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$advectionProgram.uniforms.texelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY),$7cd9a1131fd2cf81$var$ext.supportLinearFiltering||$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$advectionProgram.uniforms.dyeTexelSize,$7cd9a1131fd2cf81$var$velocity.texelSizeX,$7cd9a1131fd2cf81$var$velocity.texelSizeY);let e=$7cd9a1131fd2cf81$var$velocity.read.attach(0);$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$advectionProgram.uniforms.uVelocity,e),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$advectionProgram.uniforms.uSource,e),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$advectionProgram.uniforms.dt,a),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$advectionProgram.uniforms.dissipation,$4037aec382fdece7$export$e506a1d27d1eaa20.VELOCITY_DISSIPATION),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$velocity.write),$7cd9a1131fd2cf81$var$velocity.swap(),$7cd9a1131fd2cf81$var$ext.supportLinearFiltering||$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$advectionProgram.uniforms.dyeTexelSize,$7cd9a1131fd2cf81$var$dye.texelSizeX,$7cd9a1131fd2cf81$var$dye.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$advectionProgram.uniforms.uVelocity,$7cd9a1131fd2cf81$var$velocity.read.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$advectionProgram.uniforms.uSource,$7cd9a1131fd2cf81$var$dye.read.attach(1)),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$advectionProgram.uniforms.dissipation,$4037aec382fdece7$export$e506a1d27d1eaa20.DENSITY_DISSIPATION),$7cd9a1131fd2cf81$var$blit($7cd9a1131fd2cf81$var$dye.write),$7cd9a1131fd2cf81$var$dye.swap()}function $7cd9a1131fd2cf81$var$drawColor(a,e){$7cd9a1131fd2cf81$var$colorProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform4f($7cd9a1131fd2cf81$var$colorProgram.uniforms.color,e.r,e.g,e.b,1),$7cd9a1131fd2cf81$var$blit(a)}function $7cd9a1131fd2cf81$var$drawCheckerboard(a){$7cd9a1131fd2cf81$var$checkerboardProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$checkerboardProgram.uniforms.aspectRatio,$7cd9a1131fd2cf81$var$canvas.width/$7cd9a1131fd2cf81$var$canvas.height),$7cd9a1131fd2cf81$var$blit(a)}function $7cd9a1131fd2cf81$var$drawDisplay(a){let e=null==a?$7cd9a1131fd2cf81$var$gl.drawingBufferWidth:a.width,r=null==a?$7cd9a1131fd2cf81$var$gl.drawingBufferHeight:a.height;if($7cd9a1131fd2cf81$var$displayMaterial.bind(),$4037aec382fdece7$export$e506a1d27d1eaa20.SHADING&&$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$displayMaterial.uniforms.texelSize,1/e,1/r),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$displayMaterial.uniforms.uTexture,$7cd9a1131fd2cf81$var$dye.read.attach(0)),$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM){$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$displayMaterial.uniforms.uBloom,$7cd9a1131fd2cf81$var$bloom.attach(1)),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$displayMaterial.uniforms.uDithering,$7cd9a1131fd2cf81$var$ditheringTexture.attach(2));let a=$7cd9a1131fd2cf81$var$getTextureScale($7cd9a1131fd2cf81$var$ditheringTexture,e,r);$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$displayMaterial.uniforms.ditherScale,a.x,a.y)}$4037aec382fdece7$export$e506a1d27d1eaa20.SUNRAYS&&$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$displayMaterial.uniforms.uSunrays,$7cd9a1131fd2cf81$var$sunrays.attach(3)),$7cd9a1131fd2cf81$var$blit(a)}function $7cd9a1131fd2cf81$var$applyBloom(a,e){if($7cd9a1131fd2cf81$var$bloomFramebuffers.length<2)return;let r=e;$7cd9a1131fd2cf81$var$gl.disable($7cd9a1131fd2cf81$var$gl.BLEND),$7cd9a1131fd2cf81$var$bloomPrefilterProgram.bind();let c=$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_THRESHOLD*$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_SOFT_KNEE+1e-4,$=$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_THRESHOLD-c,t=2*c,d=.25/c;$7cd9a1131fd2cf81$var$gl.uniform3f($7cd9a1131fd2cf81$var$bloomPrefilterProgram.uniforms.curve,$,t,d),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$bloomPrefilterProgram.uniforms.threshold,$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_THRESHOLD),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$bloomPrefilterProgram.uniforms.uTexture,a.attach(0)),$7cd9a1131fd2cf81$var$blit(r),$7cd9a1131fd2cf81$var$bloomBlurProgram.bind();for(let a=0;a<$7cd9a1131fd2cf81$var$bloomFramebuffers.length;a++){let e=$7cd9a1131fd2cf81$var$bloomFramebuffers[a];$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$bloomBlurProgram.uniforms.texelSize,r.texelSizeX,r.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$bloomBlurProgram.uniforms.uTexture,r.attach(0)),$7cd9a1131fd2cf81$var$blit(e),r=e}$7cd9a1131fd2cf81$var$gl.blendFunc($7cd9a1131fd2cf81$var$gl.ONE,$7cd9a1131fd2cf81$var$gl.ONE),$7cd9a1131fd2cf81$var$gl.enable($7cd9a1131fd2cf81$var$gl.BLEND);for(let a=$7cd9a1131fd2cf81$var$bloomFramebuffers.length-2;a>=0;a--){let e=$7cd9a1131fd2cf81$var$bloomFramebuffers[a];$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$bloomBlurProgram.uniforms.texelSize,r.texelSizeX,r.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$bloomBlurProgram.uniforms.uTexture,r.attach(0)),$7cd9a1131fd2cf81$var$gl.viewport(0,0,e.width,e.height),$7cd9a1131fd2cf81$var$blit(e),r=e}$7cd9a1131fd2cf81$var$gl.disable($7cd9a1131fd2cf81$var$gl.BLEND),$7cd9a1131fd2cf81$var$bloomFinalProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$bloomFinalProgram.uniforms.texelSize,r.texelSizeX,r.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$bloomFinalProgram.uniforms.uTexture,r.attach(0)),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$bloomFinalProgram.uniforms.intensity,$4037aec382fdece7$export$e506a1d27d1eaa20.BLOOM_INTENSITY),$7cd9a1131fd2cf81$var$blit(e)}function $7cd9a1131fd2cf81$var$applySunrays(a,e,r){$7cd9a1131fd2cf81$var$gl.disable($7cd9a1131fd2cf81$var$gl.BLEND),$7cd9a1131fd2cf81$var$sunraysMaskProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$sunraysMaskProgram.uniforms.uTexture,a.attach(0)),$7cd9a1131fd2cf81$var$blit(e),$7cd9a1131fd2cf81$var$sunraysProgram.bind(),$7cd9a1131fd2cf81$var$gl.uniform1f($7cd9a1131fd2cf81$var$sunraysProgram.uniforms.weight,$4037aec382fdece7$export$e506a1d27d1eaa20.SUNRAYS_WEIGHT),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$sunraysProgram.uniforms.uTexture,e.attach(0)),$7cd9a1131fd2cf81$var$blit(r)}function $7cd9a1131fd2cf81$var$blur(a,e,r){$7cd9a1131fd2cf81$var$blurProgram.bind();for(let c=0;c<r;c++)$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$blurProgram.uniforms.texelSize,a.texelSizeX,0),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$blurProgram.uniforms.uTexture,a.attach(0)),$7cd9a1131fd2cf81$var$blit(e),$7cd9a1131fd2cf81$var$gl.uniform2f($7cd9a1131fd2cf81$var$blurProgram.uniforms.texelSize,0,a.texelSizeY),$7cd9a1131fd2cf81$var$gl.uniform1i($7cd9a1131fd2cf81$var$blurProgram.uniforms.uTexture,e.attach(0)),$7cd9a1131fd2cf81$var$blit(a)}function $7cd9a1131fd2cf81$var$correctRadius(a){let e=$7cd9a1131fd2cf81$var$canvas.width/$7cd9a1131fd2cf81$var$canvas.height;return e>1&&(a*=e),a}function $7cd9a1131fd2cf81$var$updatePointerDownData(a,e,r,c){a.id=e,a.down=!0,a.moved=!1,a.texcoordX=r/$7cd9a1131fd2cf81$var$canvas.width,a.texcoordY=1-c/$7cd9a1131fd2cf81$var$canvas.height,a.prevTexcoordX=a.texcoordX,a.prevTexcoordY=a.texcoordY,a.deltaX=0,a.deltaY=0,a.color=$7cd9a1131fd2cf81$var$generateColor()}function $7cd9a1131fd2cf81$var$updatePointerMoveData(a,e,r){a.prevTexcoordX=a.texcoordX,a.prevTexcoordY=a.texcoordY,a.texcoordX=e/$7cd9a1131fd2cf81$var$canvas.width,a.texcoordY=1-r/$7cd9a1131fd2cf81$var$canvas.height,a.deltaX=$7cd9a1131fd2cf81$var$correctDeltaX(a.texcoordX-a.prevTexcoordX),a.deltaY=$7cd9a1131fd2cf81$var$correctDeltaY(a.texcoordY-a.prevTexcoordY),a.moved=Math.abs(a.deltaX)>0||Math.abs(a.deltaY)>0}function $7cd9a1131fd2cf81$var$updatePointerUpData(a){a.down=!1}function $7cd9a1131fd2cf81$var$correctDeltaX(a){let e=$7cd9a1131fd2cf81$var$canvas.width/$7cd9a1131fd2cf81$var$canvas.height;return e<1&&(a*=e),a}function $7cd9a1131fd2cf81$var$correctDeltaY(a){let e=$7cd9a1131fd2cf81$var$canvas.width/$7cd9a1131fd2cf81$var$canvas.height;return e>1&&(a/=e),a}function $7cd9a1131fd2cf81$var$generateColor(){return{r:.1+.2*Math.random(),g:.1+.2*Math.random(),b:.1+.2*Math.random()}}function $7cd9a1131fd2cf81$var$HSVtoRGB(a,e,r){let c,$,t,d,f,i,n,o;switch(d=Math.floor(6*a),f=6*a-d,i=r*(1-e),n=r*(1-f*e),o=r*(1-(1-f)*e),d%6){case 0:c=r,$=o,t=i;break;case 1:c=n,$=r,t=i;break;case 2:c=i,$=r,t=o;break;case 3:c=i,$=n,t=r;break;case 4:c=o,$=i,t=r;break;case 5:c=r,$=i,t=n}return{r:c,g:$,b:t}}function $7cd9a1131fd2cf81$var$getResolution(a){let e=$7cd9a1131fd2cf81$var$gl.drawingBufferWidth/$7cd9a1131fd2cf81$var$gl.drawingBufferHeight;e<1&&(e=1/e);let r=Math.round(a),c=Math.round(a*e);return $7cd9a1131fd2cf81$var$gl.drawingBufferWidth>$7cd9a1131fd2cf81$var$gl.drawingBufferHeight?{width:c,height:r}:{width:r,height:c}}function $7cd9a1131fd2cf81$var$getTextureScale(a,e,r){return{x:e/a.width,y:r/a.height}}function $7cd9a1131fd2cf81$var$scaleByPixelRatio(a){let e=window.devicePixelRatio||1;return Math.floor(a*e)}class $97993d7225bc73e0$export$16f618f9c6253b50{constructor(a={}){this.nodes=[],this.links=[],this.initialConcepts={},this.initialConcepts=a}init(){this.svg=d3.select("body").append("svg").attr("width","100%").attr("height","100%");const a=d3.zoom().scaleExtent([.1,4]).on("zoom",(a=>{this.container.attr("transform",a.transform)}));$4037aec382fdece7$export$e506a1d27d1eaa20.GRAPH_ZOOM&&this.svg.call(a),this.container=this.svg.append("g").attr("class","container"),this.linksGroup=this.container.append("g").attr("class","links"),this.nodesGroup=this.container.append("g").attr("class","nodes");const e=this.svg.append("defs"),r=e.append("filter").attr("id","glow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%"),c=e.append("filter").attr("id","glowStronger").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");r.append("feGaussianBlur").attr("stdDeviation","2").attr("result","coloredBlur");const $=r.append("feMerge");$.append("feMergeNode").attr("in","coloredBlur"),$.append("feMergeNode").attr("in","SourceGraphic"),c.append("feGaussianBlur").attr("stdDeviation","6").attr("result","coloredBlur");const t=c.append("feMerge");t.append("feMergeNode").attr("in","coloredBlur"),t.append("feMergeNode").attr("in","SourceGraphic"),this.updateDimensions(),this.simulation=d3.forceSimulation().alphaDecay(0).force("link",d3.forceLink().id((a=>a.id)).distance(120).strength(.01)).force("charge",d3.forceManyBody().strength(-50)).force("x",d3.forceX(this.width/2).strength(.01)).force("y",d3.forceY(this.height/2).strength(.01)).force("collide",d3.forceCollide().radius(2*$4037aec382fdece7$export$e506a1d27d1eaa20.GRAPH_TEXT_SIZE)),this.simulation.on("tick",(()=>this.ticked())),this.populateInitialData(),window.addEventListener("resize",(()=>{this.updateDimensions(),this.simulation.force("x",d3.forceX(this.width/2).strength(.01)),this.simulation.force("y",d3.forceY(this.height/2).strength(.01)),this.simulation.alpha(1).restart()}))}updateDimensions(){this.width=window.innerWidth,this.height=window.innerHeight,this.svg.attr("width",this.width).attr("height",this.height)}populateInitialData(){Object.values(this.initialConcepts).forEach((a=>{a.forEach((a=>{this.addNode(a)}))}))}addNode(a){if(this.nodes.find((e=>e.id===a)))return void console.log(`Node ${a} already exists`);const e={id:a,label:a,x:this.width/2,y:0,vx:$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(-10,10),vy:100};return this.nodes.push(e),this.updateVisualization(),e}linkNodes(a,e){const r=this.nodes.find((e=>e.id===a)),c=this.nodes.find((a=>a.id===e));if(!r||!c)throw new Error(`Cannot link: one or both nodes don't exist (${a}, ${e})`);if(this.links.some((r=>r.source===a&&r.target===e||r.source===e&&r.target===a)))return void console.log(`Link between ${a} and ${e} already exists`);const $={source:a,target:e};return this.links.push($),r.highlighted=!0,c.highlighted=!0,this.updateVisualization(),$}updateVisualization(){this.link=this.linksGroup.selectAll("line").data(this.links,(a=>`${a.source.id||a.source}-${a.target.id||a.target}`)),this.link.exit().remove();const a=this.link.enter().append("line").attr("class","link").attr("stroke","#999").attr("stroke-width",2);this.link=a.merge(this.link),this.node=this.nodesGroup.selectAll(".node").data(this.nodes,(a=>a.id)),this.node.exit().remove();const e=this.node.enter().append("g").attr("class","node");$4037aec382fdece7$export$e506a1d27d1eaa20.NODES_DRAGGABLE&&e.call(this.drag(this.simulation));const r=$4037aec382fdece7$export$e506a1d27d1eaa20.GRAPH_TEXT_SIZE,c=a=>a.label.length*(r/2)+2*r,$=a=>2*r;e.append("rect").attr("x",(a=>-c(a)/2)).attr("y",(a=>-$(a)/2)).attr("width",(a=>c(a))).attr("height",(a=>$(a))).attr("rx",(a=>$(a)/2)).attr("ry",(a=>$(a)/2)).style("fill","#dedede").style("stroke","#e5e7eb").style("stroke-width",2).style("filter","url(#glow)").attr("transform","scale(0)").transition().duration(600).ease(d3.easeElastic.period(.75)).attr("transform","scale(1)"),e.append("text").attr("dy",r/3).attr("text-anchor","middle").text((a=>a.label)).style("fill","#2d2d2d").style("font-weight","600").style("font-size",`${r}px`).style("text-shadow","0 2px 4px rgba(0,0,0,0.3)").attr("transform","scale(0)").transition().duration(600).ease(d3.easeElastic.period(.75)).attr("transform","scale(1)"),this.node=e.merge(this.node),this.simulation.nodes(this.nodes),this.simulation.force("link").links(this.links),this.simulation.alpha(1).restart(),this.nodesGroup.raise()}drag(a){return d3.drag().on("start",(function(e){e.active||a.alphaTarget(.3).restart(),e.subject.fx=e.subject.x,e.subject.fy=e.subject.y})).on("drag",(function(a){a.subject.fx=a.x,a.subject.fy=a.y})).on("end",(function(e){e.active||a.alphaTarget(0),e.subject.fx=null,e.subject.fy=null}))}ticked(){this.container.selectAll(".link").attr("x1",(a=>a.source.x)).attr("y1",(a=>a.source.y)).attr("x2",(a=>a.target.x)).attr("y2",(a=>a.target.y)),this.container.selectAll(".node").attr("transform",(a=>`translate(${a.x}, ${a.y})`))}}class $ea160bcdf16629f6$export$1c6db324fc104d40{constructor(){this.listeners={}}on(a,e){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(e)}off(a,e){this.listeners[a]&&(this.listeners[a]=this.listeners[a].filter((a=>a!==e)))}emit(a,e){this.listeners[a]&&this.listeners[a].forEach((a=>a(e)))}processChunk(a){try{const e=JSON.parse(a.replace(/data: /,"")),r=e.object;if("boost.listener.event"===r)return this.handleBoostEvent(e);this.emit(r,e)}catch(a){console.error("Error processing chunk:",a)}}handleBoostEvent(a){const{event:e,data:r}=a;this.emit(e,r)}getChunkContent(a){return a.choices.map((a=>a.delta.content)).join("\n")}async listen(){try{const a="<<listener_id>>",e=await fetch(`http://localhost:34131/events/${a}`,{headers:{Authorization:"Bearer sk-boost"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=e.body.getReader();async function c(){for(;;){const{done:a,value:e}=await r.read();if(a){console.log("Stream complete");break}try{const a=(new TextDecoder).decode(e).split("\n\n");for(const e of a)e.trim()&&this.processChunk(e)}catch(a){console.error("Error processing data:",a)}await $889e0deb359ee8ae$export$e772c8ff12451969(10)}}await c.call(this)}catch($){console.error("Error connecting to event stream:",$)}}}class $c06724bc5a36c09c$export$baf26146a414f24a{static random(a){return new $c06724bc5a36c09c$export$baf26146a414f24a($889e0deb359ee8ae$export$e87bfa2a4c6bccb0(a.x,a.x+a.width),$889e0deb359ee8ae$export$e87bfa2a4c6bccb0(a.y,a.y+a.height))}static unitDirection(a){return new $c06724bc5a36c09c$export$baf26146a414f24a(Math.cos(a),Math.sin(a))}constructor(a=0,e=0){this.x=a,this.y=e}set(a,e){return this.x=a,this.y=e,this}len(){return Math.sqrt(this.x*this.x+this.y*this.y)}copy(){return new $c06724bc5a36c09c$export$baf26146a414f24a(this.x,this.y)}multiply(a){return new $c06724bc5a36c09c$export$baf26146a414f24a(this.x*a,this.y*a)}add(a){return new $c06724bc5a36c09c$export$baf26146a414f24a(this.x+a.x,this.y+a.y)}}class $c06724bc5a36c09c$export$c79fc6492f3af13d{static fromDOMNode(a){const e=a.getBoundingClientRect();return new $c06724bc5a36c09c$export$c79fc6492f3af13d(e.left,e.top,e.width,e.height)}constructor(a=0,e=0,r=0,c=0){this.x=a,this.y=e,this.width=r,this.height=c}set(a,e,r,c){return this.x=a,this.y=e,this.width=r,this.height=c,this}copy(){return new $c06724bc5a36c09c$export$c79fc6492f3af13d(this.x,this.y,this.width,this.height)}get center(){return new $c06724bc5a36c09c$export$baf26146a414f24a(this.x+this.width/2,this.y+this.height/2)}get aspectRatio(){return this.width/this.height}contains(a){return a.x>=this.x&&a.x<=this.x+this.width&&a.y>=this.y&&a.y<=this.y+this.height}intersects(a){return!(a.x>this.x+this.width||a.x+a.width<this.x||a.y>this.y+this.height||a.y+a.height<this.y)}union(a){const e=Math.min(this.x,a.x),r=Math.min(this.y,a.y),c=Math.max(this.x+this.width,a.x+a.width)-e,$=Math.max(this.y+this.height,a.y+a.height)-r;return new $c06724bc5a36c09c$export$c79fc6492f3af13d(e,r,c,$)}scale(a){return this.x*=a,this.y*=a,this.width*=a,this.height*=a,this}translate(a,e){return this.x+=a,this.y+=e,this}toString(){return`Rect(${this.x}, ${this.y}, ${this.width}, ${this.height})`}}class $c06724bc5a36c09c$export$d5c6c08dc2d3ca7 extends $c06724bc5a36c09c$export$c79fc6492f3af13d{static fromWindow(){const a=new $c06724bc5a36c09c$export$d5c6c08dc2d3ca7(window.innerWidth,window.innerHeight);return window.addEventListener("resize",(()=>{a.set(0,0,window.innerWidth,window.innerHeight)})),a}constructor(a=800,e=600){super(0,0,a,e)}toUnitCoords(a){return new $c06724bc5a36c09c$export$baf26146a414f24a($889e0deb359ee8ae$export$2ad466be2e2b0196(a.x,this.x,this.x+this.width,0,1),$889e0deb359ee8ae$export$2ad466be2e2b0196(a.y,this.y,this.y+this.height,0,1))}}class $b67b98cb03539fa0$export$75e5944908db37d5{constructor(){this.viewport=$c06724bc5a36c09c$export$d5c6c08dc2d3ca7.fromWindow(),this.fluidSim=new $7cd9a1131fd2cf81$export$d5f25c77fde4b279,this.graph=new $97993d7225bc73e0$export$16f618f9c6253b50,this.listener=new $ea160bcdf16629f6$export$1c6db324fc104d40}async init(){this.fluidSim.init(),this.graph.init(),this.listener.on("boost.concept",(({label:a,hex_color:e})=>{const r=this.graph.addNode(a);if(r){r.color=new $e2fcf139534465c2$export$892596cec99bc70e(.001,.001,.001);try{r.color=$e2fcf139534465c2$export$892596cec99bc70e.fromHex(e).mute(.01)}catch(a){}}})),this.listener.on("boost.linked_concepts",(({concepts:a})=>{this.graph.linkNodes(a[0],a[1])})),this.listener.on("boost.intensity",(({intensity:a})=>{this.fluidSim.noiseSpeed=$889e0deb359ee8ae$export$2ad466be2e2b0196(a,0,1,0,50)})),this.listener.on("boost.status",(({status:a})=>{Array.from(document.querySelectorAll(".status")).forEach(((e,r)=>{0===r?e.textContent=a:e.remove()}))})),this.graph.simulation.on("tick.pointers",(()=>{this.fluidSim.pointers=this.graph.nodes.map((a=>{const e=new $1c68cc7ba7d4081d$export$b56007f12edf0c17,r=this.viewport.toUnitCoords(new $c06724bc5a36c09c$export$baf26146a414f24a(a.x,a.y));let c=this.viewport.toUnitCoords(new $c06724bc5a36c09c$export$baf26146a414f24a(a.vx,a.vy));return c.len()<.001&&(c=$c06724bc5a36c09c$export$baf26146a414f24a.unitDirection(.5*Math.PI).multiply(.003)),e.moved=!0,e.texcoordX=r.x,e.texcoordY=1-r.y,e.deltaX=c.x,e.deltaY=-c.y,e.color=a.highlighted?a.color.toGlColor():e.color,e.radius=.005,e}))})),await this.listener.listen()}}document.addEventListener("DOMContentLoaded",(async()=>{const a=new $b67b98cb03539fa0$export$75e5944908db37d5;await a.init()}))</script></body></html>