<style>body{font-family:Arial,sans-serif;padding:2rem;background:#222;color:#ddd}.completion{display:flex;flex-direction:row;flex-wrap:wrap;gap:.5rem}.stats{display:flex;flex-direction:row;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid #444}.token{display:inline-block;padding:.25rem .5rem;background:#333;border-radius:.25rem}</style><script>const elements={},tokenColors={},tokenStats={},handlers={"boost.listener.event":handleBoostEvent,"chat.completion.chunk":handleCompletionChunk};async function entrypoint(){window.__init||(window.__init=!0,main())}async function main(){const n=document.createElement("div");n.classList.add("stats"),document.body.appendChild(n),elements.stats=n;const e=document.createElement("div");e.classList.add("completion"),document.body.appendChild(e),elements.completion=e;const t=(await fetch("<<boost_public_url>>/events/<<listener_id>>",{headers:{Authorization:"Bearer sk-boost"}})).body.getReader();for(;;){const{done:n,value:e}=await t.read();if(n)break;try{const n=(new TextDecoder).decode(e).split("\n\n");for(const e of n)processChunk(e)}catch(n){console.error(n)}}}function processChunk(n){const e=JSON.parse(n.replace(/data: /,"")),t=e.object,o=handlers[t];o&&(console.log("Processing chunk:",e),o(e))}function handleCompletionChunk(n){const e=getChunkContent(n),t=tokenStats[e]||0;tokenStats[e]=t+1,renderToken(e),renderStats()}function handleBoostEvent(){}function getChunkContent(n){return n.choices.map((n=>n.delta.content)).join("\n")}function randomColor(){return"rgba("+[0,0,0].map((()=>Math.floor(128*Math.random())+64)).join(", ")+")"}function getTokenColor(n){return tokenColors[n]||(tokenColors[n]=randomColor()),tokenColors[n]}function renderToken(n){const e=document.createElement("div");e.classList.add("token"),e.innerHTML=n,e.style.backgroundColor=getTokenColor(n),e.style.opacity=1/tokenStats[n],elements.completion.appendChild(e)}function renderStats(){const n=elements.stats;n.innerHTML="";for(const[e,t]of Object.entries(tokenStats).sort(((n,e)=>e[1]-n[1]))){if(t<2)continue;if(1===e.trim().length)continue;const o=document.createElement("div");o.classList.add("token"),o.innerHTML=`${e}: ${t}`,n.appendChild(o)}}entrypoint().catch(console.error)</script>