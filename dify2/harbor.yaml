# Harbor Service Configuration for Dify2
# This file configures how Harbor manages this service
# This is the SINGLE SOURCE OF TRUTH - no separate compose.dify2.yml needed

# Upstream compose transformation
# Allows using stock Docker Compose files with automatic Harbor integration
upstream:
  # Path to stock compose file (relative to this directory)
  source: ./upstream/docker/docker-compose.yaml

  # Namespace for isolation
  # Creates internal network where services use original names (api, db, redis)
  # Service names in merged compose are prefixed (dify2-api, dify2-web)
  # Original names available as aliases on internal network
  namespace: dify2

  # Services to include/exclude from stock compose
  services:
    exclude:
      - nginx
      - certbot

  # Services exposed on harbor-network
  # - Simple string: uses original name (matches upstream)
  # - Object {service: alias}: uses custom alias (e.g., for conflict avoidance)
  # Other services stay internal-only (no conflicts with other Harbor services)
  expose:
    - api                    # exposed as "api" (original name)
    - web                    # exposed as "web" (original name)
    # - web: dify2-web       # example: prefixed alias when conflict expected

  # Harbor-specific overrides (replaces compose.dify2.yml)
  # Keys are ORIGINAL service names, applied to prefixed services
  overrides:
    api:
      environment:
        - OPENAI_API_BASE=http://${HARBOR_CONTAINER_PREFIX}.ollama:11434/v1
    web:
      ports:
        - ${HARBOR_DIFY2_HOST_PORT:-3001}:3000

# Future sections (not yet implemented):
# metadata:
#   tags: [backend, api]
#   wikiUrl: https://github.com/av/harbor/wiki/dify2
#
# configs:
#   cross:
#     ollama:
#       api:
#         environment:
#           - OLLAMA_ENABLED=true
