<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Logprobs Visualization</title><style>*{box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;background:#1a1a1a;color:#e0e0e0;margin:0;padding:1.5rem;padding-top:5rem;line-height:1.8}.status{position:fixed;top:1rem;right:1rem;background:rgba(255,255,255,.1);padding:.5rem 1rem;border-radius:.5rem;font-size:.875rem;backdrop-filter:blur(10px)}.completion{font-size:1.1rem;max-width:800px;margin:0 auto}.token{display:inline;padding:.1rem 0;border-radius:.15rem;cursor:default;position:relative;transition:background-color .15s ease}.token:hover{outline:1px solid rgba(255,255,255,.3)}.tooltip{display:none;position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#2a2a2a;border:1px solid #444;border-radius:.5rem;padding:.75rem;min-width:200px;max-width:300px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,.4);font-size:.875rem;margin-bottom:.5rem}.token:hover .tooltip{display:block}.tooltip-bottom{bottom:auto;top:100%;margin-bottom:0;margin-top:.5rem}.tooltip-header{font-weight:600;margin-bottom:.5rem;padding-bottom:.5rem;border-bottom:1px solid #444;display:flex;justify-content:space-between}.tooltip-token{color:#fff;font-family:monospace;background:rgba(255,255,255,.1);padding:.1rem .3rem;border-radius:.2rem}.tooltip-prob{color:#888}.alt-list{list-style:none;margin:0;padding:0}.alt-item{display:flex;align-items:center;gap:.5rem;margin:.25rem 0;font-size:.8rem}.alt-token{font-family:monospace;min-width:60px;color:#aaa;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.alt-bar-container{flex:1;height:6px;background:rgba(255,255,255,.1);border-radius:3px;overflow:hidden}.alt-bar{height:100%;background:#666;border-radius:3px;transition:width .2s ease}.alt-prob{min-width:45px;text-align:right;color:#888;font-size:.75rem}.connection-indicator{width:8px;height:8px;border-radius:50%;background:#666;display:inline-block;margin-right:.5rem;transition:background-color .3s ease}.connection-indicator.connected{background:#22c55e;box-shadow:0 0 8px #22c55e}.connection-indicator.error{background:#ef4444;box-shadow:0 0 8px #ef4444}</style></head><body><div class="status"><span class="connection-indicator"></span> <span class="status-text">Connecting...</span></div><div class="completion"></div><script>const MIN_LOGPROB=parseFloat("<<min_logprob>>")||-10,MAX_LOGPROB=parseFloat("<<max_logprob>>")||0,HIGHLIGHT_THRESHOLD=MIN_LOGPROB+.85*(MAX_LOGPROB-MIN_LOGPROB);console.log("Logprob range:",MIN_LOGPROB,"to",MAX_LOGPROB),console.log("Highlight threshold:",HIGHLIGHT_THRESHOLD),console.log("====================");const elements={completion:document.querySelector(".completion"),status:document.querySelector(".status-text"),indicator:document.querySelector(".connection-indicator")};function logprobToProb(t){return Math.exp(t)}function formatProb(t){const e=logprobToProb(t);return e>=.01?(100*e).toFixed(1)+"%":(100*e).toFixed(3)+"%"}function getTokenColor(t){if(t>HIGHLIGHT_THRESHOLD)return"transparent";const e=.3+.6*((t-HIGHLIGHT_THRESHOLD)/(MIN_LOGPROB-HIGHLIGHT_THRESHOLD));return`rgba(239, 68, 68, ${Math.min(.9,e)})`}function escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function renderToken(t){const{token:e,logprob:o,top_logprobs:n}=t,s=document.createElement("span");s.className="token",s.style.backgroundColor=getTokenColor(o),s.setAttribute("data-logprob",o);let r=e;if("\n"===e&&(r="\n"),s.innerHTML=escapeHtml(r),s.addEventListener("mouseenter",(()=>{const t=s.querySelector(".tooltip");if(t){const e=s.getBoundingClientRect();t.style.left="50%",t.style.transform="translateX(-50%)",e.top<250?t.classList.add("tooltip-bottom"):t.classList.remove("tooltip-bottom"),requestAnimationFrame((()=>{const e=t.getBoundingClientRect(),o=window.innerWidth;let n=0;e.left<10?n=10-e.left:e.right>o-10&&(n=o-10-e.right),0!==n&&(t.style.transform=`translateX(calc(-50% + ${n}px))`)}))}})),n&&n.length>0){const t=document.createElement("div");t.className="tooltip";const r=document.createElement("div");r.className="tooltip-header",r.innerHTML=`\n          <span class="tooltip-token">${escapeHtml(e.replace(/\n/g,"↵"))}</span>\n          <span class="tooltip-prob">${formatProb(o)}</span>\n        `,t.appendChild(r);const a=document.createElement("ul");a.className="alt-list";const c=Math.max(...n.map((t=>logprobToProb(t.logprob))));n.forEach((t=>{const e=logprobToProb(t.logprob)/c*100,o=document.createElement("li");o.className="alt-item",o.innerHTML=`\n            <span class="alt-token">${escapeHtml(t.token.replace(/\n/g,"↵"))}</span>\n            <div class="alt-bar-container">\n              <div class="alt-bar" style="width: ${e}%"></div>\n            </div>\n            <span class="alt-prob">${formatProb(t.logprob)}</span>\n          `,a.appendChild(o)})),t.appendChild(a),s.appendChild(t)}elements.completion.appendChild(s)}function setStatus(t){elements.status.textContent=t}function setConnected(t){t?(elements.indicator.classList.add("connected"),elements.indicator.classList.remove("error")):(elements.indicator.classList.remove("connected"),elements.indicator.classList.add("error"))}function processChunk(t){const e=t.object;if("chat.completion.chunk"===e){const e=t.choices||[];if(0===e.length)return;const o=e[0],n=o.logprobs;if(n&&n.content)n.content.forEach((t=>{renderToken(t)}));else{const t=o.delta?.content||"";if(t){const e=document.createElement("span");e.className="token",e.textContent=t,elements.completion.appendChild(e)}}}else if("boost.listener.event"===e){const{event:e,data:o}=t;"boost.status"===e&&setStatus(o.status)}}async function startListening(){try{const t="<<listener_id>>",e="<<boost_public_url>>",o=await fetch(`${e}/events/${t}`,{headers:{Authorization:"Bearer sk-boost"}});if(!o.ok)throw new Error(`HTTP error: ${o.status}`);setConnected(!0),setStatus("Connected");const n=o.body.getReader();for(;;){const{done:t,value:e}=await n.read();if(t)break;const o=(new TextDecoder).decode(e).split("\n\n");for(const t of o)if(t.trim())try{const e=t.replace(/^data: /,"");if("[DONE]"===e){setStatus("Complete");continue}processChunk(JSON.parse(e))}catch(e){console.error("Parse error:",e,t)}}setStatus("Done")}catch(t){console.error("Connection error:",t),setConnected(!1),setStatus("Connection failed")}}startListening()</script></body></html>